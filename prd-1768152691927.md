# Beachhead Bunker Defense - Game Design Document

## 1. Summary
A fixed-position 3D defensive shooter where the player aims from a coastal bunker to eliminate wave-based amphibious troops and paratroopers before each wave timer expires; you win by clearing all waves and lose if enemies overwhelm the bunker or a wave times out with enemies still alive.
- Assumptions:
  - Realistic-ish theme but **stylized** violence (non-gory hit FX by default).
  - No external models/textures required; **primitive geometry + decals/sprites** only.
  - Desktop + mobile supported (mouse/keyboard + touch aim/fire).
  - Fixed bunker viewpoint (no player walking), but **free-aim** within a clamped cone.
  - 6 waves total for a complete “mission”; endless mode is out of scope.
  - Performance target: stable 60 FPS on modern laptop/phone using pooling + capped particles.

## 2. Technical Requirements
- Rendering: **Three.js r160**
- Single HTML file with inline CSS and JS
- Unit system: **world units** where **1 unit ≈ 1 meter**
- Three.js materials to use (valid): **MeshStandardMaterial, MeshPhongMaterial, MeshLambertMaterial, MeshBasicMaterial**
- Three.js light types to use (valid): **AmbientLight, DirectionalLight, HemisphereLight, PointLight, SpotLight**
- Particle approach:
  - Primary: **THREE.Points** for high-count particles (smoke, dust, mist)
  - Secondary: **Sprite-based particles** for muzzle flash/impact bursts (short-lived, low count)
  - Bullet tracers: thin geometry (e.g., cylinder/line-like mesh) OR bright sprites; must be pooled
  - Object pooling required for bullets/tracers/particles/enemies to avoid per-shot allocations

## 3. Canvas & Viewport
- Dimensions: **960×540** internal render size
- Background: sky-to-horizon gradient (top: #9CC7FF → horizon: #F7E6B5), subtle haze toward horizon
- Aspect ratio behavior: **letterboxed** to fit window while preserving 16:9; center the canvas, add black bars as needed

## 4. Visual Style & Art Direction
- Art style: “clean battlefield diorama” (simple geometry, strong silhouettes, heavy FX/particles for feedback)
- Mood: tense coastal defense at dawn; readable targets; dramatic impacts without cluttering aim
- Color palette (purpose-driven):
  - Sky: **#9CC7FF**
  - Haze/sunlight: **#F7E6B5**
  - Ocean deep: **#1B4F72**
  - Ocean highlight: **#4AA3DF**
  - Sand: **#D9C28A**
  - Bunker concrete: **#6E6E6E**
  - Enemy uniform: **#3D4B3D**
  - Enemy highlight/marker: **#E74C3C**
  - Friendly UI/crosshair: **#EAF2F8**
  - Hit-confirm color: **#F1C40F**
  - Critical warning: **#FF3B30**
  - Smoke: **#2C2C2C**
- Camera style: **fixed first-person bunker view**
  - Camera position: **(0, 1.6, 0)** inside bunker
  - Look direction: toward beach centerline, aiming at **(0, 1.2, -40)**
  - FOV: “sniper-capable” baseline with zoom states (see Player Specs)
- Depth feel: full 3D space; beach slopes down to water; enemies traverse Z-depth toward player
- Lighting mood:
  - HemisphereLight for soft ambient sky/bounce
  - DirectionalLight as low sun angle with long shadows (shadows can be faked if needed for performance)

## 5. Player Specifications
- Appearance:
  - Player body not shown; only weapon + bunker window framing
  - Bunker viewport: concrete frame (rectangular slit) occupying screen edges to sell “pillbox”
  - Crosshair: thin + readable; expands slightly with recoil
- Size:
  - Weapon model (procedural): rifle length ~**1.1 units**
  - Bunker slit opening: **2.4 units wide × 0.6 units tall** (visual framing only)
- Colors:
  - Weapon: dark metal **#2E2E2E**, accent **#B0B0B0**
  - Crosshair/UI: **#EAF2F8**
- Starting position:
  - Camera at bunker origin; aim centered toward mid-beach
- Movement constraints:
  - No translation (no walking)
  - Aim constraints: yaw/pitch clamped so player cannot aim behind bunker
    - Yaw: **±55°** from center
    - Pitch: **-25° (down)** to **+20° (up)**
- Weapons (2 selectable):
  1. **Sniper Rifle (precision)**
     - Fire mode: single shot
     - Rate of fire: **1 shot / 0.85 sec**
     - Damage: **120** (one-shot infantry; two-shot boats)
     - Zoom: **2.5×** (narrow FOV)
     - Recoil: high kick, quick settle
  2. **M51-style Rifle (mid-range)**
     - Fire mode: semi-auto
     - Rate of fire: **1 shot / 0.18 sec** (player can click/tap fast)
     - Damage: **45** (3-shot infantry; sustained for boats)
     - Zoom: **1.4×**
     - Recoil: moderate, faster recovery
- Animation states (weapon/camera presentation):
  - Idle: subtle weapon sway + breathing bob
  - Fire: recoil kick + muzzle flash + shell eject
  - Reload (abstracted): short “cycle” animation when magazine limit reached
  - Overheat/denied (if attempting during cooldown): dry-click visual + crosshair flick

## 6. Physics & Movement
Direction convention: **Up is +Y**, forward toward enemies is **-Z**.

| Property | Value | Unit |
|----------|-------|------|
| Gravity (paratroopers only) | 9.8 | units/sec² |
| Parachute descent speed (terminal) | 6.0 | units/sec |
| Ground troop run speed (base) | 4.2 | units/sec |
| Ground troop run speed (late waves) | 5.2 | units/sec |
| Boat approach speed | 7.5 | units/sec |
| Bullet/tracer speed (visual) | 220 | units/sec |
| Max effective range (for damage) | 180 | units |
| Ground (beach) Y position | 0.0 | units |
| Ocean surface Y position | -0.4 | units |

Notes:
- Hits are treated as hitscan-feel (instant feedback), but a fast tracer visual sells direction and distance.
- Enemies move on navigable lanes to keep readability (see Obstacles/Enemies).

## 7. Obstacles/Enemies

### 7.1 Amphibious Assault Units (Boat + Soldiers)
- Boat appearance:
  - Simple boxy landing craft: **6.5 (L) × 2.2 (W) × 1.8 (H) units**
  - Color: dull metal **#4B4B4B**, rust accents **#7A3E2A**
- Boat spawn:
  - Spawn offshore at Z = **-170** to **-150**, X in one of 3 lanes: **-18, 0, +18**
  - Approaches beach along straight line toward Z ≈ **-70**, then stops for disembark
- Boat behavior:
  - Has HP: **200**
  - When HP reaches 0: boat explodes (big FX) and spawns **0** soldiers
  - If reaches disembark point alive: spawns **4 soldiers** over **3.0 sec**
- Soldier appearance:
  - Capsule/box humanoid: **0.6 (W) × 1.8 (H) × 0.4 (D) units**
  - Color: uniform **#3D4B3D**, helmet **#2F3A2F**
- Soldier movement:
  - Runs toward bunker along a slightly zig-zag but constrained corridor (lane-based drift)
  - Lateral drift: max **±3 units** from lane center over time (keeps free-aim meaningful without unfair jukes)
- Constraints (symmetry):
  - Player has **free-aim**; enemies may move freely but are kept to lanes/drift for readability (not required for symmetry, but improves fairness)
- Despawn:
  - If soldier reaches bunker line at Z = **-6**, triggers “breach” damage (see Collision & Scoring)
  - Remove on death with death FX

### 7.2 Airborne Paratroopers
- Spawn:
  - Aircraft is implied (offscreen); paratroopers spawn at Y = **35–45**, Z = **-120 to -90**, X = **-24 to +24**
  - Spawn in clusters of **3–6** within **2 seconds**
- Parachute phase:
  - Descent speed capped at **6 units/sec**
  - Horizontal drift: slow wind push **0.8–1.4 units/sec** (varies per unit)
  - Parachute hitbox larger/easier: shooting parachute causes faster drop (optional but recommended for gameplay variety)
- Ground phase:
  - On landing (Y=0), transitions to infantry run toward bunker at standard run speed
- HP:
  - Paratrooper infantry HP: **90**
  - Parachute canopy HP (if implemented separately): **60**

### 7.3 Wave Timing
- Each wave has a fixed timer; player must clear all active enemies before timer ends.
- Default wave structure (6-wave mission):
  - Wave 1 (25s): 1 boat + 4 paratroopers
  - Wave 2 (25s): 1 boat + 6 paratroopers
  - Wave 3 (30s): 2 boats + 6 paratroopers
  - Wave 4 (30s): 2 boats + 9 paratroopers
  - Wave 5 (35s): 3 boats + 9 paratroopers
  - Wave 6 (40s): 3 boats + 12 paratroopers
- If timer hits 0 and any enemy alive: **mission failure** (no “increase difficulty”; it’s a clear fail state in V1)

## 8. World & Environment
- Layout (from far to near along -Z toward camera):
  1. Sky dome/gradient background (no geometry required beyond backdrop)
  2. Ocean plane at Y = -0.4 extending to Z = -220
  3. Shoreline band (wet sand darker) around Z ≈ -80
  4. Beach plane rising slightly toward bunker (gentle slope)
  5. Bunker interior framing (dark vignette + concrete slit)
- Ambient motion:
  - Sea mist particles drifting laterally (low density)
  - Occasional sand dust puffs near beach surface (subtle)
- Environment loops/regenerates:
  - Not an infinite runner; environment is static. Only ambient particles recycle via pooling.

## 9. Collision & Scoring
- Collision detection approach:
  - Hitscan-style ray hit against simplified hit volumes (boxes/capsules)
  - Boats: box hit volume
  - Soldiers/paratroopers: capsule-like (approximated by cylinder/box)
- Hitbox adjustments (fairness):
  - Infantry hitbox shrunk by **0.12 units** on X/Z and **0.10 units** on Y (forgiving)
  - Parachute canopy hitbox (if present) is **+0.25 units** larger than visuals (generous target)
- What triggers game over:
  1. **Wave timer expires** with any enemy still alive
  2. **Bunker integrity reaches 0** due to breaches (see below)
- Breach/integrity:
  - Player starts with **Integrity = 3**
  - Each enemy reaching Z = -6 reduces integrity by **1** and despawns that enemy (they “enter bunker”)
  - At integrity 0: immediate game over with strong impact FX
- Scoring:
  - Infantry kill: **+100**
  - Paratrooper kill during parachute descent: **+140** (priority reward)
  - Boat destroyed: **+250**
  - Accuracy bonus (end of wave): **+0 to +200** based on hit ratio thresholds
- Near-miss threshold:
  - If a bullet ray passes within **0.35 units** of an enemy hitbox without hitting: counts as near-miss (per target, cooldown 1.2s to prevent spam)
  - Near-miss bonus: **+10** and a small “Close!” floating text near crosshair
- High score storage:
  - localStorage key: **`beachhead_bunker_defense_highscore_v1`**

## 10. Controls
| Input | Action | Condition |
|-------|--------|-----------|
| Mouse move | Aim | Playing, not paused |
| Left click / Tap | Fire current weapon | Playing, weapon cooldown complete |
| Right click / Two-finger hold (mobile) | Hold breath / steady aim (reduces sway) | Playing; cancels on release |
| Mouse wheel / On-screen toggle | Switch weapon | Playing |
| Shift (hold) / On-screen “Zoom” | Zoom (weapon-specific) | Playing |
| R / On-screen “Reload” | Manual reload (optional; otherwise auto) | Playing; if magazine system enabled |
| P or Escape | Pause/Resume | Menu not active |
| Enter / On-screen “Start” | Start game | Menu |
| Space / On-screen “Retry” | Retry | Game Over |

On-screen touch UI (always visible on mobile):
- Fire button (right side), Zoom button, Weapon toggle, Pause button.

## 11. Game States

**Menu:**
- Display:
  - Title + short premise (“Defend the bunker. Clear each wave before time runs out.”)
  - Controls list (desktop + mobile) visible
  - Difficulty note: “Waves intensify; prioritize paratroopers and boats.”
- Start:
  - Click/tap Start or press Enter

**Playing:**
- Active systems:
  - Spawn manager, AI movement, shooting, collisions, particles
- UI:
  - Score, High Score, Wave number (1/6), Wave timer bar, Integrity (3 icons)
  - Controls hint line (compact): “LMB/Tap Fire • Shift Zoom • Wheel Swap • P Pause”
  - Crosshair + small wind indicator (optional) to justify parachute drift

**Paused:**
- Trigger: P or Escape or on-screen Pause
- Display:
  - Large “PAUSED”
  - Controls reminder
- Behavior:
  - Freeze timer, enemy movement, particles (either pause simulation or stop spawning and let existing fade)

**Game Over:**
- Trigger:
  - Wave timer hits 0 with enemies alive, OR integrity reaches 0
- Display:
  - “MISSION FAILED”
  - Final score, best score, wave reached
  - Retry prompt (Space / tap)
- Retry:
  - Resets score, integrity, wave index, clears all pooled active enemies/particles cleanly

## 12. Game Feel & Juice (REQUIRED)

### 12.1 Input Response
- Aim:
  - Same-frame crosshair movement; apply mild smoothing only if it doesn’t add latency (design goal: “snappy aim”)
- Fire (allowed):
  - Immediate muzzle flash + recoil kick + tracer + brief crosshair expansion (all start the same frame)
  - Hit confirmation: small crosshair tick + color flash to **#F1C40F** for 80 ms on confirmed hit
- Fire (denied due to cooldown):
  - Crosshair briefly pulses red **#FF3B30** (60 ms) + tiny camera nudge backward (2–3 px equivalent) to acknowledge input
- Zoom:
  - Smooth FOV transition; crosshair tightens; vignette darkens slightly to focus

### 12.2 Animation Timing
- Weapon recoil:
  - Kick back duration: **0.06 sec**, ease-out
  - Return duration: **0.14 sec**, ease-in
- Muzzle flash sprite burst:
  - Lifetime: **0.05–0.08 sec**
  - Scale: starts at 1.2× then fades to 0 over lifetime
- Shell ejection:
  - Spawn at weapon side; arc lifetime **0.6 sec**, then fade out
- UI transitions:
  - Menu → Playing: fade out UI over **0.25 sec**
  - Wave Complete banner: slide down + fade in **0.18 sec**, hold **0.6 sec**, fade **0.2 sec**

### 12.3 Near-Miss Rewards
- Detection:
  - Bullet ray within **0.35 units** of enemy hit volume, no hit; per-enemy near-miss cooldown **1.2 sec**
- Visual:
  - Brief radial “air rip” streak near crosshair (2–4 thin streak sprites) + subtle time dilation
  - Floating text: “CLOSE!” near center, fades in/out over **0.35 sec**
- Score:
  - +10 and a small “+10” pop

### 12.4 Screen Effects
| Effect | Trigger | Feel |
|--------|---------|------|
| Shake | Boat explosion, bunker breach | Explosion: intensity 0.8, 0.22 sec; Breach: intensity 0.6, 0.18 sec |
| Flash | Hit confirm, wave complete | Hit: small white/yellow flash 0.06 sec; Wave: warm flash #F7E6B5 at 20% opacity, 0.15 sec |
| Zoom pulse | Headshot/critical kill (optional) | Quick 1.03× zoom-in and back over 0.12 sec |
| Time dilation | Near-miss, mission fail | Near-miss: 0.85× for 0.25 sec; Fail: 0.25× for 0.6 sec + freeze frame 0.08 sec |

### 12.5 Progressive Intensity
- As waves progress:
  - Wave 1–2: baseline ambient dust, lighter smoke
  - Wave 3–4: slightly darker sky haze; tracer brightness +10%; more frequent ambient particles
  - Wave 5–6: warning UI pulses when timer < 8s; shoreline haze thickens; explosions produce longer smoke trails
- Threshold behaviors:
  - Timer < **10s**: timer bar turns **#FF3B30**, pulses every **0.5 sec**
  - Integrity = **1**: subtle red vignette (10% opacity) persists

### 12.6 Idle Life
- Player/weapon:
  - Breathing sway cycle **3.5 sec**; amplitude small so it doesn’t annoy aim
  - If holding breath: sway amplitude reduced by **60%**, but max hold **4.0 sec** then forced recovery wobble for **1.2 sec**
- Environment:
  - Sea mist drifts sideways continuously
  - Occasional distant “splash” particles far offshore (purely visual)
- UI:
  - Integrity icons gently pulse (very subtle) at 0.2% scale oscillation

### 12.7 Milestone Celebrations
- Milestone interval: every **1000 points**
- Celebration:
  - Small banner “MARKSMANSHIP +1000” + warm flash + 0.2 sec slow-mo at 0.9×
- New high score:
  - “NEW BEST!” tag next to score with gold tint **#F1C40F** for the rest of the run

### 12.8 Death Sequence
- Mission fail (timer or integrity):
  - Freeze frame **0.08 sec**
  - Quick desaturation to 35% over **0.35 sec**
  - Strong camera shake (if breach) + low, expanding smoke overlay
  - Large text “MISSION FAILED” slams in (0.18 sec) with slight screen shake
  - After **1.2 sec**, show buttons/prompts for Retry

## 13. UX Requirements
- Controls visible on menu screen (required): show both desktop + mobile mappings
- Controls hint during gameplay (required): compact hint line at bottom
- Forgiving collision: infantry hitbox shrink **0.12 units** (X/Z) and **0.10 units** (Y)
- Mobile/touch support:
  - Drag anywhere on left/middle to aim
  - Dedicated Fire button on right
  - Optional “gyro aim” is out of scope (V1)
- Readability requirements:
  - Enemies must have a subtle outline or rim-light effect via color/lighting so they don’t blend into sand
  - Parachute units must be visibly distinct (canopy color lighter, e.g., **#C9C9C9**)

## 14. Out of Scope (V1)
- Sound effects / music / voiceover
- External GLTF character/weapon models and skeletal animation
- Online leaderboards or accounts
- Endless mode / procedural mission generator
- Complex ballistics (bullet drop, wind affecting bullets)
- Melee enemies or boss fights
- Destructible terrain beyond simple decals/particles
- Accessibility settings menu (colorblind modes, remapping)

## 15. Success Criteria
- [ ] Runs from a **single HTML file** without errors
- [ ] Uses **Three.js r160** and only valid Three.js APIs/materials/lights
- [ ] Controls are visible on **menu AND during gameplay**
- [ ] Aim + fire feel instant (same-frame muzzle flash, recoil, tracer)
- [ ] Two distinct weapons function with specified rates, damage, and zoom feel
- [ ] Wave timer + wave clear condition work; failure triggers if enemies remain at 0s
- [ ] Enemies spawn as boats + paratroopers with the defined patterns and move toward bunker
- [ ] Near-misses trigger reward feedback (visual + +10) with cooldown to prevent spam
- [ ] Score updates with readable feedback; milestones trigger celebration
- [ ] High score persists via localStorage key `beachhead_bunker_defense_highscore_v1`
- [ ] Pause/resume freezes gameplay and resumes cleanly
- [ ] Death sequence is impactful (freeze, desaturate, UI slam, retry)
- [ ] Collision feels fair via hitbox shrink and clear hit confirmation feedback
- [ ] Ambient motion exists even when idle (mist/dust + weapon sway)